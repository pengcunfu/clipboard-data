[
  {
    "text": "import sys\nimport json\nfrom datetime import datetime\nfrom pathlib import Path\nfrom PySide6.QtWidgets import (QApplication, QMainWindow, QWidget, QVBoxLayout,\n                              QListWidget, QListWidgetItem, QPushButton, QLabel,\n                              QTextEdit, QHBoxLayout, QFileDialog, QMessageBox,\n                              QSystemTrayIcon, QMenu, QLineEdit)\nfrom PySide6.QtCore import Qt, QTimer\nfrom PySide6.QtGui import QClipboard, QIcon, QFont, QAction\n\nclass ClipboardHistoryWindow(QMainWindow):\n    def __init__(self):\n        super().__init__()\n        self.setWindowTitle(\"老黄剪贴板自动手机工具\")\n        self.setMinimumSize(1200, 700)  # 恢复之前的窗口大小\n        \n        # 设置应用图标\n        self.app_icon = QIcon(\"icon.png\")\n        self.setWindowIcon(self.app_icon)\n        \n        # 初始化监听状态为开启\n        self.monitoring_enabled = True\n        \n        # 设置存储路径为当前目录\n        self.storage_path = Path(\"clipboard_history.json\")\n        \n        # 设置主窗口部件\n        central_widget = QWidget()\n        self.setCentralWidget(central_widget)\n        main_layout = QHBoxLayout(central_widget)\n        main_layout.setSpacing(5)  # 减小布局间距\n        main_layout.setContentsMargins(5, 5, 5, 5)  # 减小边距\n        \n        # 左侧布局 - 列表和按钮\n        left_panel = QWidget()\n        left_layout = QVBoxLayout(left_panel)\n        left_layout.setSpacing(2)  # 减小控件间距\n        left_layout.setContentsMargins(2, 2, 2, 2)  # 减小边距到最小\n        \n        # 创建状态和控制面板\n        control_panel = QWidget()\n        control_layout = QHBoxLayout(control_panel)\n        control_layout.setContentsMargins(0, 0, 0, 0)\n        \n        # 添加搜索框\n        self.search_box = QLineEdit()\n        self.search_box.setPlaceholderText(\"搜索历史记录...\")\n        self.search_box.setStyleSheet(\"\"\"\n            QLineEdit {\n                padding: 5px;\n                border: 1px solid #ccc;\n                border-radius: 3px;\n                background-color: white;\n            }\n            QLineEdit:focus {\n                border: 1px solid #4CAF50;\n            }\n        \"\"\")\n        self.search_box.textChanged.connect(self.filter_history)\n        control_layout.addWidget(self.search_box)\n        \n        # 创建监听开关按钮，默认为开启状态\n        self.monitor_button = QPushButton(\"关闭监听\")\n        self.monitor_button.setCheckable(True)\n        self.monitor_button.setChecked(True)  # 默认选中\n        self.monitor_button.setStyleSheet(\"\"\"\n            QPushButton {\n                padding: 4px 8px;\n                background-color: #f0f0f0;\n                border: 1px solid #ccc;\n                border-radius: 3px;\n                min-width: 80px;\n            }\n            QPushButton:checked {\n                background-color: #4CAF50;\n                color: white;\n            }\n            QPushButton:hover {\n                background-color: #e0e0e0;\n            }\n            QPushButton:checked:hover {\n                background-color: #45a049;\n            }\n        \"\"\")\n        self.monitor_button.clicked.connect(self.toggle_monitoring)\n        control_layout.addWidget(self.monitor_button)\n        \n        # 添加状态标签，默认显示监听状态\n        self.status_label = QLabel(\"当前状态: 正在监听\")\n        self.status_label.setStyleSheet(\"color: #4CAF50;\")\n        control_layout.addWidget(self.status_label)\n        \n        control_layout.addStretch()\n        left_layout.addWidget(control_panel)\n        \n        # 创建历史记录标签和列表的容器\n        list_container = QWidget()\n        list_layout = QVBoxLayout(list_container)\n        list_layout.setSpacing(2)\n        list_layout.setContentsMargins(0, 0, 0, 0)\n        \n        # 创建历史记录标签\n        history_label = QLabel(\"历史记录:\")\n        history_label.setStyleSheet(\"QLabel { font-weight: bold; }\")\n        list_layout.addWidget(history_label)\n        \n        # 创建列表控件\n        self.history_list = QListWidget()\n        self.history_list.setFont(QFont(\"Microsoft YaHei\", 10))\n        self.history_list.currentItemChanged.connect(self.show_preview)\n        self.history_list.setVerticalScrollBarPolicy(Qt.ScrollBarAlwaysOn)\n        self.history_list.setHorizontalScrollBarPolicy(Qt.ScrollBarAsNeeded)\n        self.history_list.setWordWrap(True)\n        self.history_list.setSpacing(2)  # 添加项目间距\n        self.history_list.setStyleSheet(\"\"\"\n            QListWidget {\n                border: 1px solid #ccc;\n                background-color: white;\n                padding: 1px;  /* 减小列表内边距 */\n                outline: none;  /* 移除整个列表的焦点边框 */\n            }\n            QListWidget::item {\n                padding: 8px;\n                border-bottom: 1px solid #eee;\n                margin-bottom: 1px;\n                background-color: #fafafa;\n                border-radius: 3px;\n                min-height: 60px;\n                outline: none;  /* 移除列表项的焦点边框 */\n            }\n            QListWidget::item:selected {\n                background-color: #e8f5e9;\n                color: black;\n                border: 1px solid #4CAF50;\n            }\n            QListWidget::item:focus {\n                outline: none;  /* 确保焦点时也不显示边框 */\n            }\n            QListWidget::item:hover {\n                background-color: #f5f5f5;\n            }\n        \"\"\")\n        list_layout.addWidget(self.history_list)\n        left_layout.addWidget(list_container)\n        \n        # 按钮布局\n        button_layout = QHBoxLayout()\n        button_layout.setSpacing(5)  # 保持按钮间距\n        button_layout.setContentsMargins(0, 0, 0, 0)  # 移除按钮布局边距\n        \n        # 创建按钮并设置样式\n        button_style = \"\"\"\n            QPushButton {\n                padding: 4px 8px;\n                background-color: #f0f0f0;\n                border: 1px solid #ccc;\n                border-radius: 3px;\n                min-width: 60px;\n            }\n            QPushButton:hover {\n                background-color: #e0e0e0;\n            }\n            QPushButton:pressed {\n                background-color: #d0d0d0;\n            }\n        \"\"\"\n        \n        clear_button = QPushButton(\"清空\")\n        clear_button.clicked.connect(self.clear_history)\n        clear_button.setStyleSheet(button_style)\n        button_layout.addWidget(clear_button)\n        \n        copy_button = QPushButton(\"复制\")\n        copy_button.clicked.connect(self.copy_selected)\n        copy_button.setStyleSheet(button_style)\n        button_layout.addWidget(copy_button)\n        \n        export_button = QPushButton(\"导出\")\n        export_button.clicked.connect(self.export_history)\n        export_button.setStyleSheet(button_style)\n        button_layout.addWidget(export_button)\n        \n        button_layout.addStretch()  # 添加弹性空间，使按钮靠左对齐\n        \n        left_layout.addLayout(button_layout)\n        \n        # 将左侧面板添加到主布局\n        main_layout.addWidget(left_panel, 3)  # 增加左侧比例为3\n        \n        # 右侧布局 - 预览区域\n        right_panel = QWidget()\n        right_layout = QVBoxLayout(right_panel)\n        right_layout.setSpacing(2)\n        right_layout.setContentsMargins(0, 0, 0, 0)\n        \n        # 创建预览标签\n        preview_label = QLabel(\"内容预览:\")\n        preview_label.setStyleSheet(\"QLabel { font-weight: bold; }\")\n        right_layout.addWidget(preview_label)\n        \n        # 创建预览文本框\n        self.preview_text = QTextEdit()\n        self.preview_text.setReadOnly(True)\n        self.preview_text.setFont(QFont(\"Microsoft YaHei\", 10))\n        self.preview_text.setStyleSheet(\"\"\"\n            QTextEdit {\n                border: 1px solid #ccc;\n                background-color: white;\n                padding: 8px;\n            }\n        \"\"\")\n        right_layout.addWidget(self.preview_text)\n        \n        # 将右侧面板添加到主布局\n        main_layout.addWidget(right_panel, 2)  # 减小右侧比例为2\n        \n        # 初始化剪贴板监视器\n        self.clipboard = QApplication.clipboard()\n        self.clipboard.dataChanged.connect(self.on_clipboard_change)\n        \n        # 加载历史记录\n        self.load_history()\n        \n        # 设置定时保存\n        self.save_timer = QTimer()\n        self.save_timer.timeout.connect(self.save_history)\n        self.save_timer.start(30000)  # 每30秒保存一次\n        \n        # 设置系统托盘\n        self.setup_system_tray()\n    \n    def setup_system_tray(self):\n        # 创建系统托盘图标并使用相同的图标\n        self.tray_icon = QSystemTrayIcon(self.app_icon, self)\n        self.tray_icon.setToolTip(\"老黄剪贴板采集小工具\")\n        \n        # 创建托盘菜单\n        tray_menu = QMenu()\n        \n        # 添加显示/隐藏动作\n        show_action = QAction(\"显示主窗口\", self)\n        show_action.triggered.connect(self.show)\n        tray_menu.addAction(show_action)\n        \n        # 添加开关监听动作，默认显示关闭监听\n        self.toggle_action = QAction(\"关闭监听\", self)\n        self.toggle_action.triggered.connect(self.monitor_button.click)\n        tray_menu.addAction(self.toggle_action)\n        \n        # 添加分隔符\n        tray_menu.addSeparator()\n        \n        # 添加退出动作\n        quit_action = QAction(\"退出\", self)\n        quit_action.triggered.connect(self.close)\n        tray_menu.addAction(quit_action)\n        \n        # 设置托盘图标的菜单\n        self.tray_icon.setContextMenu(tray_menu)\n        self.tray_icon.show()\n        \n        # 连接托盘图标的点击事件\n        self.tray_icon.activated.connect(self.on_tray_icon_activated)\n    \n    def on_tray_icon_activated(self, reason):\n        if reason == QSystemTrayIcon.ActivationReason.DoubleClick:\n            self.show()\n            self.activateWindow()\n    \n    def toggle_monitoring(self):\n        self.monitoring_enabled = self.monitor_button.isChecked()\n        if self.monitoring_enabled:\n            self.monitor_button.setText(\"关闭监听\")\n            self.status_label.setText(\"当前状态: 正在监听\")\n            self.status_label.setStyleSheet(\"color: #4CAF50;\")\n            self.toggle_action.setText(\"关闭监听\")\n        else:\n            self.monitor_button.setText(\"开启监听\")\n            self.status_label.setText(\"当前状态: 未监听\")\n            self.status_label.setStyleSheet(\"color: #666;\")\n            self.toggle_action.setText(\"开启监听\")\n    \n    def closeEvent(self, event):\n        reply = QMessageBox.question(\n            self,\n            \"确认退出\",\n            \"确定要退出程序吗？\",\n            QMessageBox.Yes | QMessageBox.No,\n            QMessageBox.No\n        )\n        \n        if reply == QMessageBox.Yes:\n            self.save_history()\n            event.accept()\n        else:\n            event.ignore()\n            self.hide()\n    \n    def on_clipboard_change(self):\n        if not self.monitoring_enabled:\n            return\n            \n        mime_data = self.clipboard.mimeData()\n        if mime_data.hasText():\n            text = mime_data.text()\n            if text.strip():\n                timestamp = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n                preview = text.split('\\n')[0]\n                if len(preview) > 300:  # 显示更多预览内容\n                    preview = preview[:300] + \"...\"\n                \n                # 格式化显示，时间戳和内容分两行显示\n                display_text = f\"{timestamp}\\n{preview}\"\n                \n                item = QListWidgetItem(display_text)\n                item.setData(Qt.UserRole, {\n                    'timestamp': timestamp,\n                    'text': text\n                })\n                self.history_list.insertItem(0, item)\n                self.history_list.setCurrentItem(item)\n                self.save_history()\n    \n    def show_preview(self, current, previous):\n        if current:\n            data = current.data(Qt.UserRole)\n            self.preview_text.setText(data['text'])\n    \n    def load_history(self):\n        try:\n            if self.storage_path.exists():\n                with open(self.storage_path, 'r', encoding='utf-8') as f:\n                    history = json.load(f)\n                    for entry in reversed(history):\n                        preview = entry['text'].split('\\n')[0]\n                        if len(preview) > 300:  # 保持一致的预览长度\n                            preview = preview[:300] + \"...\"\n                        # 格式化显示，时间戳和内容分两行显示\n                        display_text = f\"{entry['timestamp']}\\n{preview}\"\n                        item = QListWidgetItem(display_text)\n                        item.setData(Qt.UserRole, {\n                            'timestamp': entry['timestamp'],\n                            'text': entry['text']\n                        })\n                        self.history_list.addItem(item)\n        except Exception as e:\n            print(f\"加载历史记录失败: {e}\")\n    \n    def save_history(self):\n        try:\n            history = []\n            for i in range(self.history_list.count()):\n                item = self.history_list.item(i)\n                data = item.data(Qt.UserRole)\n                history.append(data)\n            with open(self.storage_path, 'w', encoding='utf-8') as f:\n                json.dump(history, f, ensure_ascii=False, indent=2)\n        except Exception as e:\n            print(f\"保存历史记录失败: {e}\")\n    \n    def clear_history(self):\n        reply = QMessageBox.question(\n            self,\n            \"确认清空\",\n            \"确定要清空所有历史记录吗？\\n此操作不可恢复！\",\n            QMessageBox.Yes | QMessageBox.No,\n            QMessageBox.No\n        )\n        \n        if reply == QMessageBox.Yes:\n            self.history_list.clear()\n            self.preview_text.clear()\n            self.save_history()\n            QMessageBox.information(self, \"提示\", \"历史记录已清空！\")\n    \n    def copy_selected(self):\n        current_item = self.history_list.currentItem()\n        if current_item:\n            data = current_item.data(Qt.UserRole)\n            self.clipboard.setText(data['text'])\n    \n    def export_history(self):\n        try:\n            file_path, _ = QFileDialog.getSaveFileName(\n                self,\n                \"导出历史记录\",\n                str(Path.home() / \"clipboard_history.txt\"),\n                \"Text Files (*.txt)\"\n            )\n            if file_path:\n                with open(file_path, 'w', encoding='utf-8') as f:\n                    for i in range(self.history_list.count()):\n                        item = self.history_list.item(i)\n                        data = item.data(Qt.UserRole)\n                        f.write(f\"{data['text']}\\n\\n\")\n                QMessageBox.information(self, \"导出成功\", \"历史记录已成功导出！\")\n        except Exception as e:\n            QMessageBox.critical(self, \"导出失败\", f\"导出历史记录失败: {str(e)}\")\n    \n    def filter_history(self, search_text):\n        \"\"\"根据搜索文本过滤历史记录\"\"\"\n        search_text = search_text.lower()\n        for i in range(self.history_list.count()):\n            item = self.history_list.item(i)\n            data = item.data(Qt.UserRole)\n            text_content = data['text'].lower()\n            timestamp = data['timestamp'].lower()\n            \n            # 在时间戳和内容中搜索\n            item.setHidden(search_text not in text_content and search_text not in timestamp)\n\ndef main():\n    app = QApplication(sys.argv)\n    window = ClipboardHistoryWindow()\n    window.show()\n    sys.exit(app.exec())\n\nif __name__ == '__main__':\n    main()\n\n",
    "timestamp": "2025-06-25 20:31:24"
  },
  {
    "text": "\nCtrl+K to generate a command\n@main.py 不要让窗口整体变大了，而是把左侧内容区域变大，显示更多的复制内容的预览\n\n我明白了，我们将调整布局比例和预览内容的显示，让左侧内容区域显示更多信息，同时保持窗口大小不变。我将：\n恢复窗口大小\n调整左右面板的比例\n增加预览内容的显示长度\n优化列表项的显示格式\n让我来修改：\n现在让我们优化列表项的显示，让每个项目显示更多的预览内容：\n最后，让我们调整列表项的样式以更好地显示两行内容：\n我已经完成了所有改进，主要包括以下更新：\n恢复了窗口大小为1200x700像素\n调整了左右面板的比例为3:2（之前是2:3），使左侧面板显示更多内容\n优化了内容显示：\n增加了预览文本长度到300字符（之前是200字符）\n将时间戳和预览内容分成两行显示，更容易阅读\n增加了列表项的最小高度为60px，确保两行内容都能完整显示\n增加了内边距到10px，使内容更加清晰\n优化了列表项的样式：\n调整了内边距和间距\n保持了清晰的视觉层次\n优化了选中和悬停效果\n现在左侧区域会：\n占据更大的空间（60%的窗口宽度）\n显示更多的预览内容（300字符）\n以更清晰的两行格式显示信息\n保持良好的可读性\n这些改变应该能让你看到更多的内容预览，同时保持窗口大小不变。需要我进一步调整任何部分吗？\n@main.py 左侧的内容区域边距更小，并且底部按钮靠左显示\n\n我来调整左侧内容区域的边距和底部按钮的对齐方式：\n我已经完成了以下调整：\n减小了左侧面板的边距：\n将整体边距设置为最小值（2px）\n减小了控件之间的间距\n减小了列表内边距到2px\n减小了列表项的内边距到8px\n减小了列表项之间的间距到1px\n减小了边框圆角到3px，使其更紧凑\n调整了底部按钮的对齐：\n移除了按钮布局的边距\n在按钮后添加了弹性空间，使按钮靠左对齐\n保持了按钮之间的间距，确保按钮不会挤在一起\n这些改变应该会让左侧区域显示更多内容，同时保持清晰的视觉层次。底部按钮现在会靠左对齐，看起来更整洁。需要我进一步调整任何部分吗？\n@main.py 选中不要有那个虚线内框\n\n我来移除列表项选中时的虚线内框（焦点框）。这需要在样式表中添加相关的设置：\n我已经添加了以下样式设置来移除虚线内框：\n在列表控件级别添加了 outline: none 来移除整个列表的焦点边框\n在列表项级别添加了 outline: none 来移除每个项目的焦点边框\n添加了专门的 :focus 伪类样式，确保",
    "timestamp": "2025-06-25 20:31:18"
  },
  {
    "text": "器的扩展管理界面，或者访问chrome://extensions/\n\nEdge\nedge-open-settings",
    "timestamp": "2025-06-23 22:52:17"
  },
  {
    "text": "由于浏览器限制，强制扩展升级 Manifest V3，在 2025 年 6 月后将全面停止 Manifest V2 版本的扩展；\n\n在 Manifest V3 的限制下，必须开启开发者模式/用户脚本功能才能正常使用脚本猫扩展。\n\n参考内容：面向扩展程序用户的开发者模式、Manifest V3\n\n在浏览器内核版本>=138 时，需要打开允许用户脚本，低版本<138 则为开启开发者模式。\n\n如果你使用的 Windows 8/7/XP 系统，或者浏览器内核版本低于<120，需要自行手动安装旧版脚本猫，v0.16.6 是最后一个支持 Manifest V2 的版本，安装步骤可以参考：加载解压缩方式安装扩展。\n\n开启开发者模式",
    "timestamp": "2025-06-23 22:52:14"
  }
]