name: Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  release:
    name: Release on ${{ matrix.platform }}
    permissions:
      contents: write
    strategy:
      fail-fast: false
      matrix:
        platform: [macos-latest, ubuntu-22.04, windows-latest]

    runs-on: ${{ matrix.platform }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies (ubuntu only)
        if: matrix.platform == 'ubuntu-22.04'
        run: |
          sudo apt-get update
          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.0-dev libjavascriptcoregtk-4.0-dev libappindicator3-dev librsvg2-dev patchelf

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install Rust stable
        uses: dtolnay/rust-toolchain@stable

      - name: Rust cache
        uses: swatinem/rust-cache@v2
        with:
          workspaces: './src-tauri -> target'
          key: ${{ matrix.platform }}

      - name: Install frontend dependencies
        run: npm ci

      - name: Build the app
        uses: tauri-apps/tauri-action@v0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tagName: ${{ github.ref_name }}
          releaseName: 'å‰ªè´´æ¿å·¥å…· v__VERSION__'
          releaseBody: |
            ## å‰ªè´´æ¿è‡ªåŠ¨æ”¶é›†å·¥å…· v__VERSION__
            
            ### åŠŸèƒ½ç‰¹æ€§
            - ğŸ¯ **è‡ªåŠ¨ç›‘å¬å‰ªè´´æ¿** - å®æ—¶æ•è·å‰ªè´´æ¿å†…å®¹å˜åŒ–
            - ğŸ“ **å†å²è®°å½•ç®¡ç†** - ä¿å­˜æ‰€æœ‰å‰ªè´´æ¿å†å²è®°å½•
            - ğŸ” **å¿«é€Ÿæœç´¢** - æ”¯æŒå…³é”®è¯æœç´¢å†å²è®°å½•
            - ğŸ“‹ **ä¸€é”®å¤åˆ¶** - å¿«é€Ÿå¤åˆ¶å†å²è®°å½•åˆ°å‰ªè´´æ¿
            - ğŸ’¾ **å¯¼å‡ºåŠŸèƒ½** - å°†å†å²è®°å½•å¯¼å‡ºä¸ºæ–‡æœ¬æ–‡ä»¶
            - ğŸ¨ **ç°ä»£åŒ–UI** - ä½¿ç”¨ Ant Design ç»„ä»¶åº“
            - ğŸ”” **ç³»ç»Ÿæ‰˜ç›˜** - æœ€å°åŒ–åˆ°ç³»ç»Ÿæ‰˜ç›˜ï¼Œéšæ—¶è®¿é—®
            - âš¡ **é«˜æ€§èƒ½** - Rust åç«¯ä¿è¯é«˜æ•ˆè¿è¡Œ
            
            ### æŠ€æœ¯æ ˆ
            - **åç«¯**: Rust + Tauri
            - **å‰ç«¯**: React + TypeScript + Ant Design
            - **æ„å»ºå·¥å…·**: Vite
            
            ### ä¸‹è½½è¯´æ˜
            - **Windows**: ä¸‹è½½ `.msi` æˆ– `.exe` å®‰è£…åŒ…
            - **macOS**: ä¸‹è½½ `.dmg` æ–‡ä»¶
            - **Linux**: ä¸‹è½½ `.AppImage` æˆ– `.deb` æ–‡ä»¶
            
            ### ä½¿ç”¨è¯´æ˜
            1. å®‰è£…å¹¶å¯åŠ¨åº”ç”¨
            2. åº”ç”¨ä¼šè‡ªåŠ¨ç›‘å¬å‰ªè´´æ¿å˜åŒ–
            3. ä½¿ç”¨æœç´¢æ¡†å¿«é€ŸæŸ¥æ‰¾å†å²è®°å½•
            4. ç‚¹å‡»è®°å½•æŸ¥çœ‹å®Œæ•´å†…å®¹
            5. ä½¿ç”¨"å¤åˆ¶"æŒ‰é’®å°†å†…å®¹å¤åˆ¶åˆ°å‰ªè´´æ¿
            
            ### æ›´æ–°æ—¥å¿—
            æŸ¥çœ‹å®Œæ•´æ›´æ–°æ—¥å¿—è¯·è®¿é—® [README.md](https://github.com/pengcunfu/clipboard-data/blob/master/README.md)
          releaseDraft: false
          prerelease: false
